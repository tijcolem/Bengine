function Bengine(e,t){var n={},i={},o={};if(i.variables={},i.variables.qengine={},i.variables.qengine.randomseed=Math.floor(4294967296*Math.random()),i.options={},"object"!=typeof e)var a={};else a=Object.assign({},e);if(i.options.blockLimit=a.blockLimit||16,i.options.defaultText=!1!==a.defaultText,i.options.enableAutoSave=a.enableSave||!1,i.options.enableSingleView=a.enableSingleView||!1,i.options.loadStyles=!1!==a.loadStyles,i.options.mediaLimit=a.mediaLimit||100,i.options.mode=a.mode||"bengine",i.options.playableMediaLimit=a.playableMediaLimit||180,i.options.swidth=a.swidth||"900px",o.categoryCounts={media:0,text:0,quiz:0,unknown:0},o.engineID="",o.pagePath="",o.quizData={data:{},grade:null,stepConditional:"",stepCurrent:0,stepNext:null,submitData:{},store:[]},i.getEngineID=function(){return o.engineID},i.getPagePath=function(){return o.pagePath},o.blockMethod={},o.extAPI={},o.datahandler={},o.helper={},"object"!=typeof Bengine.extensibles)throw Error("Bengine.extensibles must be an object.");o.extensibles=Object.assign({},Bengine.extensibles);var l=["type","name","category","upload","accept","destroy","fetchDependencies","insertContent","afterDOMinsert","runBlock","runData","saveContent","showContent","styleBlock"];for(var r in o.extensibles)!function(e){var t=Object.keys(o.extensibles[e]);if(l.forEach(function(n){if(!t.includes(n))throw delete o.extensibles[e],Error("Bengine: invalid extensible configuration in "+e+". Missing method: "+n)}),o.extensibles.hasOwnProperty(e))switch(o.extensibles[e].category){case"media":o.categoryCounts.media++;break;case"text":o.categoryCounts.text++;break;case"quiz":o.categoryCounts.quiz++;break;default:throw new Error("Invalid Category In Extensibles")}o.extensibles[e].p=o.extAPI,o.extensibles[e].d=i}(r);o.blockMethod.unknownBlock=function(e){this.type=e,this.name=e,this.category="unknown",this.upload=!1,this.accept=null,this.destroy=function(){return null},this.fetchDependencies=function(){return null},this.insertContent=function(e,t){return e.innerHTML="<p class='bengine_unknown_block'>unknown block</p>",e},this.afterDOMinsert=function(e,t){return null},this.runBlock=null,this.runData=function(e){return null},this.saveContent=function(e){return{}},this.showContent=function(e,t){return e.innerHTML="unknown block",e},this.styleBlock=function(){return""}},"object"!=typeof t&&(t={alerts:null,display:null}),"object"!=typeof t.alerts||null===t.alerts?o.alerts={alert:function(e){window.alert(e)},confirm:function(e){window.confirm(e)},log:function(e){console.log(e)}}:o.alerts=Object.assign({},t.alerts);var s=Object.keys(o.alerts);["alert","confirm","log"].forEach(function(e){if(!s.includes(e))throw Error("Bengine: invalid alerts configuration. Missing method: "+e)}),"function"!=typeof t.display||null===t.display?(o.displayClass=function(e){this.engineID=e},o.displayClass.prototype.progressFinalize=function(){},o.displayClass.prototype.progressInitialize=function(){},o.displayClass.prototype.progressUpdate=function(){},o.displayClass.prototype.updateSaveStatus=function(){}):o.displayClass=t.display;var d=Object.keys(o.displayClass.prototype);["progressFinalize","progressInitialize","progressUpdate","updateSaveStatus"].forEach(function(e){if(!d.includes(e))throw Error("Bengine: invalid display configuration in. Missing method: "+e)}),function(){if(i.options.loadStyles){if(null!==document.getElementById("bengine-global-styles"))return;var e=document.createElement("style");e.id="bengine-global-styles",e.type="text/css",e.innerHTML=`\n\t\t\t.bengine-block-style {\n\t\t\t}\n\t\t\t.bengine-instance {\n\t\t\t\theight: 100%;\n\t\t\t}\n\t\t\t.bengine-block-style-embed {\n\t\t\t\theight: 85vh !important;\n\t\t\t\tmargin: 0 !important;\n\t\t\t}\n\t\t\t.bengine-x-blocks {\n\t\t\t\theight: 100%;\n\t\t\t}\n\t\t\t.bengine-single-view {\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 15vh;\n\t\t\t\tposition: absolute;\n\t\t\t\tbottom: 0;\n\t\t\t\tright: 0;\n\t\t\t}\n\t\t\t.bengine-btn-embed {\n\t\t\t\tborder: 0;\n\t\t\t\tcolor: black;\n\t\t\t\tfloat: left;\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 100%;\n\t\t\t\tpadding: 0px 30px;\n\t\t\t\ttext-align: center;\n\t\t\t\tcursor: pointer;\n\t\t\t\ttransition: background-color .5s;\n\t\t\t\ttouch-action: manipulation;\n\t\t\t\tfont-size: 1em;\n\t\t\t\tfont-weight: 400;\n\t\t\t}\n\t\t\t.bengine-btn-color {\n\t\t\t\tbackground-color: rgb(0, 0, 0);\n\t\t\t\tcolor: white;\n\t\t\t\tfont-size: 1.3em;\n\t\t\t}\n\t\t\t.bengine-btn-color:hover {\n\t\t\t\tbackground-color: rgba(0, 0, 0, 0.6);\n\t\t\t\tcolor: black;\n\t\t\t}\n\t\t\t.bengine-block {\n\t\t\t\tmargin: 0;\n\t\t\t\tpadding: 0;\n\t\t\t}\n\t\t\t.bengine-blockbtns {\n\t\t\t\tmargin: 50px auto 0px auto;\n\t\t\t\tposition: relative;\n\t\t\t}\n\t\t\t\n\t\t\t.bengine-blockbtn {\n\t\t\t\tcolor: black;\n\t\t\t\tborder: 1px solid black;\n\t\t\t\n\t\t\t\twidth: 100%;\n\t\t\t\n\t\t\t\tpadding: 6px 12px;\n\t\t\t\ttext-align: center;\n\t\t\t\n\t\t\t\tcursor: pointer;\n\t\t\t\ttransition: background-color .5s;\n\t\t\t\ttouch-action: manipulation;\n\t\t\t\n\t\t\t\tfont-size: 1em;\n\t\t\t\tfont-weight: 400;\n\t\t\t}\n\t\t\t.bengine-addbtn {\n\t\t\t\tbackground-color: white;\n\t\t\t}\n\t\t\t.bengine-addbtn:hover {\n\t\t\t\tbackground-color: lightgray;\n\t\t\t}\n\t\t\t.bengine-delbtn {\n\t\t\t\tbackground-color: #ff1818;\n\t\t\t}\n\t\t\t.bengine-delbtn:hover {\n\t\t\t\tbackground-color: #a81313;\n\t\t\t}\n\t\t\t.bengine-x-ns-cond {\n\t\t\t\tpadding: 5px 8px;\n\t\t\t\tborder: 1px solid black;\n\t\t\t\t\n\t\t\t\tdisplay: inline-block;\n\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\n\t\t\t\tfont-size: 0.9em;\n\t\t\t}\n\t\t\t.bengine_unknown_block {\n\t\t\t\tdisplay: inline-block;\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 32px;\n\t\t\t\tborder: 1px solid white;\n\t\t\t\tpadding: 6px 6px;\n\t\t\t\tmargin: 0px;\n\t\t\t\tbox-sizing: border-box;\n\t\t\t\ttext-align: center;\n\t\t\t\tfont-family: Arial, Helvetica, sans-serif;\n\t\t\t\tfont-size: 1em;\n\t\t\t\tfont-weight: bold;\n\t\t\t\tcolor: white;\n\t\t\t\tbackground-color:black;\n\t\t\t\t\n\t\t\t}\n\t\t\t.bengine-iframe {\n\t\t\t\toverflow:hidden;\t\n\t\t\t}\n\t\t\t@media screen and (max-width: ${i.options.swidth}) {\n\t\t\t\t.bengine-blockbtns { width: 100%; }\n\t\t\t\t.bengine-blockbtn { width: 100%; }\n\t\t\t}\n\t\t\t`,e.innerHTML+=".col{box-sizing:border-box;position:relative;float:left;min-height:1px;height:100%}.col-1{width:1%}.col-2{width:2%}.col-3{width:3%}.col-4{width:4%}.col-5{width:5%}.col-6{width:6%}.col-7{width:7%}.col-8{width:8%}.col-9{width:9%}.col-10{width:10%}.col-11{width:11%}.col-12{width:12%}.col-13{width:13%}.col-14{width:14%}.col-15{width:15%}.col-16{width:16%}.col-17{width:17%}.col-18{width:18%}.col-19{width:19%}.col-20{width:20%}.col-21{width:21%}.col-22{width:22%}.col-23{width:23%}.col-24{width:24%}.col-25{width:25%}.col-26{width:26%}.col-27{width:27%}.col-28{width:28%}.col-29{width:29%}.col-30{width:30%}.col-31{width:31%}.col-32{width:32%}.col-33{width:33%}.col-34{width:34%}.col-35{width:35%}.col-36{width:36%}.col-37{width:37%}.col-38{width:38%}.col-39{width:39%}.col-40{width:40%}.col-41{width:41%}.col-42{width:42%}.col-43{width:43%}.col-44{width:44%}.col-45{width:45%}.col-46{width:46%}.col-47{width:47%}.col-48{width:48%}.col-49{width:49%}.col-50{width:50%}.col-51{width:51%}.col-52{width:52%}.col-53{width:53%}.col-54{width:54%}.col-55{width:55%}.col-56{width:56%}.col-57{width:57%}.col-58{width:58%}.col-59{width:59%}.col-60{width:60%}.col-61{width:61%}.col-62{width:62%}.col-63{width:63%}.col-64{width:64%}.col-65{width:65%}.col-66{width:66%}.col-67{width:67%}.col-68{width:68%}.col-69{width:69%}.col-70{width:70%}.col-71{width:71%}.col-72{width:72%}.col-73{width:73%}.col-74{width:74%}.col-75{width:75%}.col-76{width:76%}.col-77{width:77%}.col-78{width:78%}.col-79{width:79%}.col-80{width:80%}.col-81{width:81%}.col-82{width:82%}.col-83{width:83%}.col-84{width:84%}.col-85{width:85%}.col-86{width:86%}.col-87{width:87%}.col-88{width:88%}.col-89{width:89%}.col-90{width:90%}.col-91{width:91%}.col-92{width:92%}.col-93{width:93%}.col-94{width:94%}.col-95{width:95%}.col-96{width:96%}.col-97{width:97%}.col-98{width:98%}.col-99{width:99%}.col-100{width:100%}.col-1_1{width:100%}.col-1_2{width:50%}.col-1_3{width:33.33%}.col-2_3{width:66.66%}.col-1_4{width:25%}.col-1_5{width:20%}.col-1_6{width:16.66%}.col-1_7{width:14.28%}.col-1_8{width:12.5%}.col-1_9{width:11.11%}.col-1_10{width:10%}.col-1_11{width:9.09%}.col-1_12{width:8.33%}",document.getElementsByTagName("head")[0].appendChild(e)}}(),o.helper.counter=function(e){return void 0===this.track||0===this.track?(this.track=1,1):e?(this.track=0,0):(this.track++,this.track)},o.helper.position=function(e){return void 0===this.prev?(this.prev=0,this.curr=e):0===e?(this.prev=0,this.curr=0):this.curr!==e&&(this.prev=this.curr,this.curr=e),console.log([e,this.prev,this.curr]),[this.prev,this.curr]},o.helper.emptyDiv=function(e){if("object"==typeof e)for(;e.hasChildNodes();)e.removeChild(e.lastChild)},o.helper.createURL=function(e){var t=window.location.href,n=t.split("/");return t=(n[2].match(/localhost.*/),n[0]+"//"+n[2]+encodeURI(e))},o.helper.readCookie=function(e){for(var t=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var o=n[i];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return null},o.helper.retrieveResource=function(e){return new Promise(function(t,n){var i=new XMLHttpRequest;i.open("GET",o.helper.createURL(e),!0),i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE)switch(i.status){case 200:t({msg:"Success",status:200,data:{file:i.responseText}});break;case 404:n({msg:"File Not Found",status:404,data:{}});break;default:n({msg:"Unknown Error",status:i.status,data:{}})}},i.send()})},o.helper.sleep=function(e){return new Promise(t=>setTimeout(t,e))},o.extAPI.alerts=o.alerts,o.extAPI.checkConditional=function(e){var t=!0;return e.conditional&&(cparts=e.conditional.split("."),cparts[0]in i.variables&&cparts[1]in i.variables[cparts[0]]&&i.variables[cparts[0]][cparts[1]]||(t=!1)),t},o.extAPI.createUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},o.extAPI.decodeHTML=function(){var e=document.createElement("div");return function(t){return t&&"string"==typeof t&&(e.innerHTML=t,t=e.textContent,e.textContent=""),t}}(),o.extAPI.emptyObject=function(e){return 0===Object.keys(e).length&&e.constructor===Object},o.extAPI.getResourcePath=function(e){let t,n=e.split(/\.(.+)/).filter(function(e){return 0!=e.length});try{t=i.variables[n[0]][n[1]]}catch(e){}return void 0===t&&o.alerts.log("Qengine resource not found: "+e,"error"),t},o.extAPI.replaceVars=function(e){let t=/@@(.*?)@@/g;var n,a=e;do{if(n=t.exec(e)){let e,t=n[1].split(".");try{e=i.variables[t[0]][t[1]]}catch(t){e="",o.alerts.log("Qengine variable not found: "+n[1],"error")}a=a.replace(n[0],e)}}while(n);return a},o.extAPI.sendData=function(e,t){return new Promise(function(n,i){var a=new XMLHttpRequest;a.open("POST",o.helper.createURL(e),!0),a.setRequestHeader("Content-type","application/json"),a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.DONE)switch(a.status){case 500:i({msg:"unknown",status:500,data:{}});break;case 0:i({msg:"unknown",status:0,data:{}});break;case 200:n(JSON.parse(a.responseText));break;default:i(JSON.parse(a.responseText))}},a.send(JSON.stringify(t))})},o.loadBlocksShowReady=async function(e){var t,n=document.getElementById(o.engineID);if("undefined"===n)return-1;n.innerHTML="",n.style.height="100%",(t=document.createElement("div")).setAttribute("class","bengine-instance"),t.setAttribute("id","bengine-instance-"+o.engineID),n.appendChild(t);var a=document.createElement("div");a.setAttribute("class","bengine-x-blocks"),a.setAttribute("id","bengine-x-blocks-"+o.engineID),a.innerHTML="<p style='color:white'>loading blocks...</p>",t.appendChild(a),o.blockMethod.blockStyle();var l=o.blockMethod.blockScripts();for(let e=0;e<l.length;e++)for(var r=0;void 0===window[l[e]];){if(r>100){console.log("Reached wait limit for script: "+l[e]);break}await o.helper.sleep(100),r++}var s=0,d=1,c=e.length;for(a.innerHTML="";s<c;){var u=o.blockMethod.generateBlock(d,e[s]);try{var b=o.extensibles[e[s]].showContent(u,e[s+1])}catch(t){let n=e[s];throw o.alerts.alert("Missing Block Dependency: "+n+". Check Console For More Information"),t}i.options.enableSingleView?b.children[0].className+=" bengine-block-style-embed":b.children[0].className+=" bengine-block-style";var p=document.createElement("div");p.setAttribute("class","bengine-block bengine-block-"+o.engineID),p.setAttribute("id","bengine-"+o.engineID+"-"+d),i.options.enableSingleView&&1!==d&&p.setAttribute("style","display:none;visibility:hidden;"),p.appendChild(b),a.appendChild(p),o.extensibles[e[s]].afterDOMinsert("bengine-a-"+o.engineID+"-"+d,null),s+=2,d++}if(i.options.enableSingleView){function h(e){var t=-1;e&&(t=1);var n=document.getElementById("bengine-currentBlock-"+o.engineID),i=Number(n.getAttribute("data-currentBlock")),a=i+t,l=document.getElementById("bengine-"+o.engineID+"-"+a);null!==l&&(document.getElementById("bengine-"+o.engineID+"-"+i).setAttribute("style","display:none;visibility:hidden;"),l.setAttribute("style","display:block;visibility:visible;"),n.setAttribute("data-currentBlock",a))}var g=document.createElement("div");g.setAttribute("id","bengine-single-view-"+o.engineID),g.setAttribute("class","bengine-single-view");var m=document.createElement("button");m.setAttribute("class","bengine-btn-embed bengine-btn-color"),m.setAttribute("style","width: 50%;"),m.innerHTML="&larr;",m.onclick=function(){h(!1)};var f=document.createElement("button");f.setAttribute("class","bengine-btn-embed bengine-btn-color"),f.setAttribute("style","width: 50%;"),f.innerHTML="&rarr;",f.onclick=function(){h(!0)};var y=document.createElement("div");y.setAttribute("id","bengine-currentBlock-"+o.engineID),y.setAttribute("data-currentBlock",1),y.setAttribute("style","display:none;visibility:hidden;"),g.appendChild(m),g.appendChild(f),g.appendChild(y),t.appendChild(g)}},n.loadBlocksShow=function(e,t,n=null){try{if("string"!=typeof e)throw Error("Invalid engineID passed to loadBlocksShow()");if("string"!=typeof t)throw Error("Invalid pagePath passed to loadBlocksShow()");if(null!==n&&!Array.isArray(n))throw Error("pageData must be array passed to loadBlocksShow()")}catch(e){return o.alerts.alert(e.message),-1}if(t=t.replace(/^\/(.+)?\/$/g,"$1"),o.engineID=e,o.pagePath=t,null===n){var i=o.helper.readCookie("filename");o.helper.retrieveResource("/content/"+t+"/"+i+"_bengine.json").then(function(e){dataObj=JSON.parse(e.data.file),rpageData=[];for(let e=0;e<dataObj.types.length;e++)rpageData.push(dataObj.types[e]),rpageData.push(dataObj.content[e]);"loading"!==document.readyState?o.loadBlocksShowReady(rpageData):window.addEventListener("DOMContentLoaded",function(){o.loadBlocksShowReady(rpageData)})},function(e){o.alerts.alert("Error: "+e.msg+" Status: "+e.status)})}else"loading"!==document.readyState?o.loadBlocksShowReady(n):window.addEventListener("DOMContentLoaded",function(){o.loadBlocksShowReady(n)})},this.loadBlocksShow=n.loadBlocksShow,o.loadQuizShowReady=async function(e){var t=document.createElement("style");t.innerHTML="body, html { height: 100%; }",document.getElementsByTagName("head")[0].appendChild(t);var n,a=document.getElementById(o.engineID);if("undefined"===a)return-1;a.innerHTML="",a.style.height="100%",(n=document.createElement("div")).setAttribute("class","bengine-instance"),n.setAttribute("id","bengine-instance-"+o.engineID),a.appendChild(n);var l=document.createElement("div");l.setAttribute("class","bengine-x-blocks"),l.setAttribute("id","bengine-x-blocks-"+o.engineID),l.innerHTML="<p style='color:white'>loading blocks...</p>",n.appendChild(l);var r=o.blockMethod.blockScripts();for(let e=0;e<r.length;e++)for(var s=0;void 0===window[r[e]];){if(s>100){console.log("Reached wait limit for script: "+r[e]);break}await o.helper.sleep(100),s++}function d(){var e=document.createElement("iframe");e.setAttribute("class","col col-100 bengine-iframe"),e.setAttribute("style","visibility:hidden;display:none"),e.setAttribute("frameBorder","0"),this.iframe=e,this.setUp=function(e,t){e.innerHTML="",e.appendChild(this.iframe);var n=document.createElement("style");n.innerHTML=document.getElementById("bengine-global-styles").innerHTML,this.iframe.contentDocument.head.appendChild(n);var i=document.createElement("form");i.addEventListener("submit",t),this.iframe.contentDocument.body.appendChild(i)}}o.quizData.data=e;var c=new d;async function u(e,t,n,i){if(-1===n||n>=t.length)e.setAttribute("style","visibility:visible;display:block");else{for(var a=t[n],l=t[n+1],r=o.extensibles[a].runData(l,e,i),s=0;!i.done&&s<100;)await o.helper.sleep(50),s++;100===s&&o.alerts.log(a+" never completed.");var d=!1;switch(a){case"qstep":o.quizData.stepCurrent[0];"string"==typeof r&&(o.quizData.stepConditional=r),d=!0;break;case"qstore":"object"==typeof r&&"Array"===r.constructor.name&&(o.quizData.store=o.quizData.store.concat(r));break;case"qans":"number"==typeof r&&(o.quizData.grade=r)}(n+=2)+2<t.length-1?o.quizData.stepNext=n:o.quizData.stepNext=-1,d&&(n=-1),i.done=!1,u(e,t,n,i)}}c.setUp(l,function e(t){t.preventDefault();for(var n=0;n<t.srcElement.elements.length;n++){var a=t.srcElement.elements[n].name,r=t.srcElement.elements[n].value,s=a.split(".");o.quizData.submitData[s[0]]?o.quizData.submitData[s[0]][s[1]]=r:(o.quizData.submitData[s[0]]={},o.quizData.submitData[s[0]][s[1]]=r)}var c=!1;o.quizData.stepConditional?(s=o.quizData.stepConditional.split("."),o.quizData.submitData[s[0]]&&o.quizData.submitData[s[0]][s[1]]&&(c=!0)):c=!0;if(c){var b={};o.quizData.store.forEach(function(e){var t=e.split(".");b[t[0]]||(b[t[0]]={}),b[t[0]][t[1]]=i.variables[t[0]][t[1]]}),i.variables=Object.assign(b,o.quizData.submitData),o.quizData.submitData={},o.quizData.stepConditional="",o.quizData.stepCurrent=o.quizData.stepNext,o.quizData.stepNext=null,o.quizData.submitData={},o.quizData.store=[];var p=new d;p.setUp(l,e),u(p.iframe,o.quizData.data,o.quizData.stepCurrent,{done:!1})}return!1}),u(c.iframe,e,0,{done:!1})},n.loadQuizShow=function(e,t,n=null){try{if("string"!=typeof e)throw Error("Invalid engineID passed to loadQuizShow()");if("string"!=typeof t)throw Error("Invalid pagePath passed to loadQuizShow()");if(null!==n&&!Array.isArray(n))throw Error("pageData must be array passed to loadQuizShow()")}catch(e){return o.alerts.alert(e.message),-1}if(t=t.replace(/^\/(.+)?\/$/g,"$1"),o.engineID=e,o.pagePath=t,null===n){var i=o.helper.readCookie("filename");o.helper.retrieveResource("/content/"+t+"/"+i+"_bengine.json").then(function(e){dataObj=JSON.parse(e.data.file),rpageData=[];for(let e=0;e<dataObj.types.length;e++)rpageData.push(dataObj.types[e]),rpageData.push(dataObj.content[e]);"loading"!==document.readyState?o.loadQuizShowReady(rpageData):window.addEventListener("DOMContentLoaded",function(){o.loadQuizShowReady(rpageData)})},function(e){o.alerts.alert("Error: "+e.msg+" Status: "+e.status)})}else"loading"!==document.readyState?o.loadQuizShowReady(n):window.addEventListener("DOMContentLoaded",function(){o.loadQuizShowReady(n)})},this.loadQuizShow=n.loadQuizShow,o.loadBlocksEditReady=async function(e){o.status=1;var t,n=document.getElementById(o.engineID);if(null===n)return-1;n.innerHTML="",n.style.height="100%",o.display=new o.displayClass(o.engineID,o.datahandler),(t=document.createElement("div")).setAttribute("class","bengine-instance"),t.setAttribute("id","bengine-instance-"+o.engineID),n.appendChild(t);var i=document.createElement("div");i.setAttribute("class","bengine-x-blocks"),i.setAttribute("id","bengine-x-blocks-"+o.engineID),i.innerHTML="<p style='color:white'>loading blocks...</p>",t.appendChild(i);for(var a=0;a<e.length;a+=2)void 0===o.extensibles[e[a]]&&(o.categoryCounts.unknown+=1,o.extensibles[e[a]]=new o.blockMethod.unknownBlock(e[a]));o.blockMethod.blockStyle();var l=o.blockMethod.blockScripts();for(let e=0;e<l.length;e++)for(var r=0;void 0===window[l[e]];){if(r>100){console.log("Reached wait limit for script: "+l[e]);break}await o.helper.sleep(100),r++}i.innerHTML="";var s=o.blockMethod.blockButtons(0);s.childNodes.length;i.appendChild(s);var d=0,c=(a=1,e.length);s.childNodes[0].lastChild.children[0].style.visibility=c<2?"hidden":"visible";var u=0;for(Object.keys(o.categoryCounts).forEach(function(e){0!==o.categoryCounts[e]&&(u+=1)});d<c;){var b=o.blockMethod.generateBlock(a,e[d]),p=o.extensibles[e[d]].insertContent(b,e[d+1]);p=o.blockMethod.addRunBtn(a,o.extensibles[e[d]],p),(s=o.blockMethod.blockButtons(a)).childNodes[0].children[u].children[0].style.visibility=d===c-2?"hidden":"visible";var h=document.createElement("div");h.setAttribute("class","bengine-block bengine-block-"+o.engineID),h.setAttribute("id","bengine-"+o.engineID+"-"+a),h.appendChild(p),h.appendChild(s),i.appendChild(h),o.extensibles[e[d]].afterDOMinsert("bengine-a-"+o.engineID+"-"+a,null),d+=2,a++}var g=document.createElement("input");g.setAttribute("type","file"),g.setAttribute("id","bengine-file-select-"+o.engineID);var m=document.createElement("button");m.setAttribute("type","submit"),m.setAttribute("id","upload-button");var f=o.helper.createURL("/upload"),y=document.createElement("form");y.setAttribute("id","file-form"),y.setAttribute("action",f),y.setAttribute("method","POST"),y.style.visibility="hidden",y.appendChild(g),y.appendChild(m),t.appendChild(y)},n.loadBlocksEdit=function(e,t,n=null){try{if("string"!=typeof e)throw Error("Invalid engineID passed to blockEngineStart()");if("string"!=typeof t)throw Error("Invalid pagePath passed to blockEngineStart()");if(null!==n&&!Array.isArray(n))throw Error("pageData must be array passed to blockEngineStart()")}catch(e){return o.alerts.alert(e.message),-1}if(t=t.replace(/^\/(.+)?\/$/g,"$1"),o.engineID=e,o.pagePath=t,null===n){var i=o.helper.readCookie("filename");o.helper.retrieveResource("/content/"+t+"/"+i+"_bengine.json").then(function(e){dataObj=JSON.parse(e.data.file),rpageData=[];for(let e=0;e<dataObj.types.length;e++)rpageData.push(dataObj.types[e]),rpageData.push(dataObj.content[e]);"loading"!==document.readyState?o.loadBlocksEditReady(rpageData):window.addEventListener("DOMContentLoaded",function(){o.loadBlocksEditReady(rpageData)})},function(e){404===e.status?o.loadBlocksEditReady([]):o.alerts.alert("Error: "+e.msg+" Status: "+e.status)})}else"loading"!==document.readyState?o.loadBlocksEditReady(n):window.addEventListener("DOMContentLoaded",function(){o.loadBlocksEditReady(n)})},this.loadBlocksEdit=n.loadBlocksEdit,o.blockMethod.blockScripts=function(){function e(t,n,i,o,a){if(o&&void 0===window[o]&&a<100)a++,setTimeout(function(){e(t,n,i,o,a)},100);else{var l=n[i];if(""===l.source||t.indexOf(l.source)<0){t.push(l.source);var r=document.createElement("script");r.async=!1,r.src=l.source,r.type=l.type,l.integrity&&(r.integrity=l.integrity),r.innerHTML=l.inner,document.getElementsByTagName("head")[0].appendChild(r),n.length>i+1&&e(t,n,i+1,"",0)}}}var t=[];for(var n in o.extensibles)!function(n){if(o.extensibles.hasOwnProperty(n)){var i=o.extensibles[n].fetchDependencies();null!==i&&(e([],i,0,"",0),i.forEach(function(e){e.wait&&t.push(e.wait)}))}}(n);return t},o.blockMethod.blockStyle=function(){for(var e in o.extensibles)!function(e){if(o.extensibles.hasOwnProperty(e)){var t=document.createElement("style");t.type="text/css",t.innerHTML=o.extensibles[e].styleBlock(),document.getElementsByTagName("head")[0].appendChild(t)}}(e)},o.blockMethod.countBlocks=function(){for(var e=0,t=!0;!0===t;)e++,t=Boolean(document.getElementById("bengine-"+o.engineID+"-"+e));return--e},o.blockMethod.generateBlock=function(e,t){var n=document.createElement("div");return i.options.enableSingleView||"title"===t||n.setAttribute("style","margin-bottom:26px;"),n.setAttribute("data-btype",t),n.setAttribute("id","bengine-a-"+o.engineID+"-"+e),n},o.blockMethod.blockButtons=function(e){var t=document.createElement("div");t.setAttribute("class","row"),t.setAttribute("id","bengine-b-"+o.engineID+"-"+e);var n=document.createElement("div");n.setAttribute("id","bengine-cat-"+o.engineID+"-"+e),n.setAttribute("class","bengine-blockbtns row"),t.appendChild(n);let i=1;var a=[];let l;switch(o.categoryCounts.media>0&&(i++,a.push("media")),o.categoryCounts.text>0&&(i++,a.push("text")),o.categoryCounts.quiz>0&&(i++,a.push("quiz")),o.categoryCounts.unknown>0&&(i++,a.push("unknown")),i){case 2:l="50";break;case 3:l="1_3";break;case 4:l="25";break;case 5:l="20";break;default:l="100"}a.forEach(function(i){var a=document.createElement("div");a.setAttribute("class","col col-"+l);var r=document.createElement("button");r.onclick=function(){n.setAttribute("style","display:none;visibility:hidden"),document.getElementById("bengine-"+o.engineID+"-"+i+"-"+e).setAttribute("style","display:block;visibility:visible;")},r.setAttribute("class","bengine-blockbtn bengine-addbtn"),r.innerHTML=i;var s=document.createElement("div");s.setAttribute("id","bengine-"+o.engineID+"-"+i+"-"+e),s.setAttribute("class","bengine-blockbtns row"),s.setAttribute("style","display:none;visibility:hidden;"),t.appendChild(s);var d=document.createElement("div");d.setAttribute("class","col col-100");var c=document.createElement("button");c.onclick=function(){n.setAttribute("style","display:block;visibility:visible"),document.getElementById("bengine-"+o.engineID+"-"+i+"-"+e).setAttribute("style","display:none;visibility:hidden;")},c.setAttribute("class","bengine-blockbtn bengine-addbtn"),c.innerHTML="&larr;";var u=document.createElement("div");u.setAttribute("class","row"),d.appendChild(c),u.appendChild(d),s.appendChild(u),a.appendChild(r),n.appendChild(a)});var r=document.createElement("div");r.setAttribute("class","col col-"+l);var s=document.createElement("button");for(var d in s.setAttribute("id","bengine-d-"+o.engineID+"-"+e),s.setAttribute("class","bengine-blockbtn bengine-delbtn"),s.onclick=function(){o.blockMethod.deleteBlock(e)},s.style.visibility="hidden",s.innerHTML="&darr;",r.appendChild(s),n.appendChild(r),o.extensibles)!function(i){if(o.extensibles.hasOwnProperty(i)){var l=document.createElement("button");l.onclick=function(){o.blockMethod.addBlock(e,o.extensibles[i].type),n.setAttribute("style","display:block;visibility:visible"),document.getElementById("bengine-"+o.engineID+"-"+o.extensibles[i].category+"-"+e).setAttribute("style","display:none;visibility:hidden;")},l.setAttribute("class","bengine-blockbtn bengine-addbtn"),l.innerHTML=o.extensibles[i].name;var r=t.childNodes[a.indexOf(o.extensibles[i].category)+1],s=document.createElement("div");s.setAttribute("class","row");var d=document.createElement("div");d.setAttribute("class","col col-100"),d.appendChild(l),s.appendChild(d),r.appendChild(s)}}(d);return t},o.blockMethod.addRunBtn=function(e,t,n){if(t.upload)return n;if(null===t.runBlock)return n;var i=document.createElement("button");return"code"===t.category?i.innerHTML="Run Code":i.innerHTML="Run Block",i.onclick=function(){t.runBlock(i.parentNode.id)},n.appendChild(i),n},o.blockMethod.makeSpace=function(e,t){for(var n=t;e<n;){var i=n+1,a=o.blockMethod.blockButtons(i);document.getElementById("bengine-b-"+o.engineID+"-"+n).parentNode.replaceChild(a,document.getElementById("bengine-b-"+o.engineID+"-"+n)),document.getElementById("bengine-a-"+o.engineID+"-"+n).setAttribute("id","bengine-a-"+o.engineID+"-"+i),document.getElementById("bengine-"+o.engineID+"-"+n).setAttribute("id","bengine-"+o.engineID+"-"+i),n--}},o.blockMethod.insertBlock=function(e,t,n,i){var a=document.getElementById("bengine-x-blocks-"+o.engineID),l=document.createElement("div");if(l.setAttribute("class","bengine-block bengine-block-"+o.engineID),l.setAttribute("id","bengine-"+o.engineID+"-"+n),l.appendChild(e),l.appendChild(t),n<=i){var r=a.children[n];a.insertBefore(l,r)}else a.appendChild(l)},o.blockMethod.createBlock=function(e,t){var n=o.blockMethod.countBlocks();e<n&&o.blockMethod.makeSpace(e,n);var i=e+1,a=o.blockMethod.generateBlock(i,t.type),l=t.insertContent(a,{});l=o.blockMethod.addRunBtn(i,t,l);var r=o.blockMethod.blockButtons(i);o.blockMethod.insertBlock(l,r,i,n),t.afterDOMinsert("bengine-a-"+o.engineID+"-"+i,null);for(var s=0;s<=n;)document.getElementById("bengine-d-"+o.engineID+"-"+s).style.visibility="visible",s++},o.blockMethod.addBlock=function(e,t){if(i.options.blockLimit<document.getElementsByClassName("bengine-block-"+o.engineID).length+1)o.alerts.alert("You Have Reached The Block Limit");else{var n=o.extensibles[t];n.upload?o.datahandler.uploadMedia(e+1,n):(o.blockMethod.createBlock(e,n),o.display.updateSaveStatus("Not Saved"),i.options.enableAutoSave&&saveBlocks(!1))}},o.blockMethod.closeSpace=function(e,t){for(var n=e;n<t;){var i=n+1,a=o.blockMethod.blockButtons(n);document.getElementById("bengine-b-"+o.engineID+"-"+i).parentNode.replaceChild(a,document.getElementById("bengine-b-"+o.engineID+"-"+i)),document.getElementById("bengine-a-"+o.engineID+"-"+i).setAttribute("id","bengine-a-"+o.engineID+"-"+n),document.getElementById("bengine-"+o.engineID+"-"+i).setAttribute("id","bengine-"+o.engineID+"-"+n),n++}},o.blockMethod.removeBlock=function(e){let t=document.getElementById("bengine-"+o.engineID+"-"+e),n=t.childNodes[0],i=n.getAttribute("data-btype");o.extensibles[i].destroy(n),t.parentNode.removeChild(t)},o.blockMethod.deleteBlock=function(e){var t=o.blockMethod.countBlocks(),n=e+1;o.blockMethod.removeBlock(n),n<t&&o.blockMethod.closeSpace(n,t);var a=0;for(t=o.blockMethod.countBlocks();a<t;)document.getElementById("bengine-d-"+o.engineID+"-"+a).style.visibility="visible",a++;document.getElementById("bengine-d-"+o.engineID+"-"+a).style.visibility="hidden",o.display.updateSaveStatus("Not Saved"),i.options.enableAutoSave&&saveBlocks(!1)},"bengine"===i.options.mode?o.datahandler.createFile=function(){var e=o.blockMethod.countBlocks(),t=1,n=[];if(e>0)for(;e>=t;){let e=document.getElementById("bengine-a-"+o.engineID+"-"+t).getAttribute("data-btype");if("quiz"===o.extensibles[e].category){n.push("# "+e+" block cannot be used with Bengine\n\n"),0,t++;continue}let i=o.extensibles[e].saveContent("bengine-a-"+o.engineID+"-"+t).content.replace(/\{\%/g,"\\{%").replace(/\%\}/g,"\\%}");"qstep"!==e?n.push(`{%${e}\n${i}\n%}\n\n`):n.push(`@@@@${i}\n\n`),0,t++}var i=n.join(""),a=window.open();a.document.open(),a.document.write("<html><head><title>Bengine File</title></head><body>"),a.document.write("<pre>"+i+"</pre>"),a.document.write("</body></html>"),a.document.close()}:"qengine"===i.options.mode?o.datahandler.createFile=function(){var e=o.blockMethod.countBlocks(),t=1,n=[];if(e>0)for(var i=1;e>=t;){let e=document.getElementById("bengine-a-"+o.engineID+"-"+t).getAttribute("data-btype");if("quiz"!==o.extensibles[e].category){n.push("# "+e+" block cannot be used with Qengine\n\n"),0,t++;continue}let r=o.extensibles[e].saveContent("bengine-a-"+o.engineID+"-"+t),s=r.content.replace(/\{\%/g,"\\{%").replace(/\%\}/g,"\\%}");var a,l;a=Object.keys(r).includes("namespace")&&r.namespace.length>0?r.namespace.trim():"ns"+i++,l=Object.keys(r).includes("conditional")?r.conditional.trim():"","qstep"!==e?n.push(`{%${e}:${a}:${l}\n${s}\n%}\n\n`):n.push(`@@@@${s}\n\n`),0,t++}var r=n.join(""),s=window.open();s.document.open(),s.document.write("<html><head><title>Qengine File</title></head><body>"),s.document.write("<pre>"+r+"</pre>"),s.document.write("</body></html>"),s.document.close()}:o.datahandler.createFile=function(){},o.datahandler.revertBlocks=function(){var e,t=o.helper.createURL("/revertblocks"),n=document.getElementById("bengine-x-id-"+o.engineID).getAttribute("data-xid"),i=document.getElementById("bengine-x-id-"+o.engineID).getAttribute("name");e=new XMLHttpRequest;var a="xid="+n+"&pagetype="+i;e.open("POST",t,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){if(e.readyState===XMLHttpRequest.DONE)switch(e.status){case 500:o.alerts.alert("Unknown Error. Status: 500");break;case 0:o.alerts.alert("Unknown Error. Status: 0");break;case 200:var t=JSON.parse(e.responseText),a=document.getElementById("bengine-instance-"+o.engineID),l=a.parentNode;l.removeChild(a),""===t.data?blockEngineStart(l.getAttribute("id"),[i,n],[]):blockEngineStart(l.getAttribute("id"),[i,n],t.data.split(",")),o.display.updateSaveStatus("Saved");break;default:t=JSON.parse(e.responseText);o.alerts.alert("Error. Status: "+e.status+" Message: "+t.msg)}},e.send(a)},o.datahandler.saveBlocks=function(e){var t;t=!1===e?0:1,o.status=t;var n=[],i=[],a=o.blockMethod.countBlocks(),l=1,r={};if(a>0)for(var s=0;a>=l;){var d=document.getElementById("bengine-a-"+o.engineID+"-"+l).getAttribute("data-btype");n[s]=d,i[s]=o.extensibles[d].saveContent("bengine-a-"+o.engineID+"-"+l),s++,l++}r.types=n,r.content=i;var c,u=o.helper.createURL("/save");c=new XMLHttpRequest,!1!==e&&(c.upload.onprogress=function(e){e.lengthComputable&&o.display.progressUpdate(e.loaded)},c.upload.onloadstart=function(e){o.display.progressInitialize("Saving...",e.total)},c.upload.onloadend=function(e){o.display.progressFinalize("Saved",e.total)}),r.eid=o.engineID,r.fpath=o.pagePath,r.tabid=t,c.open("POST",u,!0),c.setRequestHeader("Content-type","application/json"),c.onreadystatechange=function(){if(c.readyState===XMLHttpRequest.DONE)switch(c.status){case 500:o.alerts.alert("Unknown Error. Status: 500");break;case 0:o.alerts.alert("Unknown Error. Status: 0");break;case 200:1===t&&o.display.updateSaveStatus("Saved");break;default:var e=JSON.parse(c.responseText);o.alerts.alert("Error. Status: "+c.status+" Message: "+e.msg)}},c.send(JSON.stringify(r))},o.datahandler.uploadProcess=function(e,t,n){o.blockMethod.createBlock(e-1,t),new Promise(function(i,a){var l=new FormData;l.append("media",n,n.name);var r=o.helper.createURL("/upload?fpath="+encodeURIComponent(o.pagePath)+"&btype="+t.type),s=new XMLHttpRequest;s.open("POST",r,!0),s.upload.onloadstart=function(e){o.display.progressInitialize("Uploading...",e.total)},s.upload.onprogress=function(e){e.lengthComputable&&o.display.progressUpdate(e.loaded)},s.upload.onloadend=function(e){o.display.progressFinalize("Uploaded",e.total)},s.onprogress=function(e){var t=o.helper.position(s.responseText.length),n=o.helper.counter(!1),i=s.responseText.slice(t[0],t[1]).split(",");1===n?o.display.progressInitialize("Converting...",i[i.length-1]):o.display.progressUpdate(i[i.length-1])},s.onloadend=function(e){var t=o.helper.position(s.responseText.length),n=s.responseText.slice(t[0],t[1]).split(",");o.display.progressFinalize("Not Saved",n[n.length-1]),o.helper.counter(!0),o.helper.position(0)},s.onreadystatechange=function(){if(s.readyState===XMLHttpRequest.DONE)switch(s.status){case 500:o.blockMethod.deleteBlock(e-1),a({msg:"unknown",status:500,data:{}});break;case 0:o.blockMethod.deleteBlock(e-1),a({msg:"unknown",status:0,data:{}});break;case 200:var t=o.helper.position(s.responseText.length),n=s.responseText.slice(t[0],t[1]).split(",");i({msg:"Success",status:200,data:{spot:n[n.length-1]}});break;default:o.blockMethod.deleteBlock(e-1);var l=JSON.parse(s.responseText);a({msg:l.msg,status:s.status,data:{}})}},s.send(l)}).then(function(n){t.afterDOMinsert("bengine-a-"+o.engineID+"-"+e,n.data.spot),o.display.updateSaveStatus("Not Saved"),i.options.enableAutoSave&&saveBlocks(!1)},function(e){o.alerts.log("Error: "+e.msg+" Status: "+e.status)})},o.datahandler.uploadMedia=function(e,t){var n=document.getElementById("bengine-file-select-"+o.engineID);"undefined"!==t.accept&&"string"==typeof t.accept?n.setAttribute("accept",t.accept):n.setAttribute("accept",""),n.click(),n.onchange=function(){var a=n.files[0];if(n.files.length>0)if(a.size>1048576*i.options.mediaLimit)o.alerts.alert(`Files Must Be Less Than ${i.options.mediaLimit} MB`);else{var l=!1,r=!1;switch(t.type){case"audio":var s=document.createElement("audio"),d=URL.createObjectURL(a);s.src=d,r=!0;break;case"video":var c=document.createElement("video"),u=URL.createObjectURL(a);c.src=u,l=!0}l?c.ondurationchange=function(){this.duration>i.options.playableMediaLimit?o.alerts.alert(`Videos Must Be Less Than ${i.options.playableMediaLimit} Seconds`):o.datahandler.uploadProcess(e,t,a)}:r?s.ondurationchange=function(){this.duration>i.options.playableMediaLimit?o.alerts.alert(`Videos Must Be Less Than ${i.options.playableMediaLimit} Seconds`):o.datahandler.uploadProcess(e,t,a)}:o.datahandler.uploadProcess(e,t,a),this.value=null}else this.value=null}}}function Qengine(e,t){if("object"!=typeof e)var n={};else n=e;return n.mode="qengine",new Bengine(n,t)}Bengine.loadBlocks=function(e,t){if(void 0===e)return-1;"object"!=typeof t&&(t={});var n=e,i=[];function o(e){var t,o;"SCRIPT"===e.target.tagName&&(void 0!==(t=e.target.src.split("/").pop().split(".")[0])&&(console.log("failed to load: "+t),i.push(t),-1!==(o=n.indexOf(t))&&n.splice(o,1)));"LINK"===e.target.tagName&&(void 0!==(t=e.target.href.split("/").pop().split(".")[0])&&(console.log("failed to link: "+t),i.push(t),-1!==(o=n.indexOf(t))&&n.splice(o,1)))}function a(e){return new Promise(t=>setTimeout(t,e))}return window.addEventListener("error",o,!0),e.forEach(function(e){if(e.indexOf(".css")>-1){var i=document.createElement("link");i.onload=function(t){var i=n.indexOf(e);-1!==i&&n.splice(i,1)},i.rel="stylesheet",i.defer=!0,i.href=e,document.getElementsByTagName("head")[0].appendChild(i)}else{var o=document.createElement("script");if(o.onload=function(t){var i=n.indexOf(e);-1!==i&&n.splice(i,1)},o.async=!1,e.indexOf("http")>-1&&e.indexOf("//")>-1)if(e.indexOf("RELATIVE")>-1){var a=e.split("/").slice(3).join("/");o.src=a}else o.src=e;else t.optimize?o.src="blocks_minified/"+e+".min.js":o.src="blocks/"+e+".js";o.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(o)}}),new Promise(async function(e,t){for(var l=0;n.length>0&&l<100;)await a(50),l++;window.removeEventListener("error",o),e(i)})},Bengine.extensibles={};